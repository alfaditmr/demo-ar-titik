<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DEBUG Camera - demo-ar-titik</title>
  <style>
    html,body{margin:0;height:100%;background:#0b0f1a;color:#eaf0ff;font-family:system-ui,Arial}
    .wrap{padding:14px;max-width:900px;margin:0 auto}
    .card{background:#111a2e;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;margin:10px 0}
    button{width:100%;padding:14px;border-radius:12px;border:none;font-size:16px;font-weight:700;margin:8px 0}
    #video{width:100%;max-height:60vh;background:#000;border-radius:14px}
    code{white-space:pre-wrap;word-break:break-word}
    .muted{opacity:.8;font-size:13px;line-height:1.35}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="font-size:18px;font-weight:800;">DEBUG Camera</div>
      <div class="muted">
        Ini untuk memastikan browser bisa open camera di <b>origin</b> kamu (alfaditmr.github.io).<br/>
        Kalau gagal, error aslinya akan muncul di bawah.
      </div>
    </div>

    <div class="card">
      <button id="btnSimple">START CAMERA (Simple)</button>
      <button id="btnBack">START CAMERA (Back/Environment)</button>
      <button id="btnStop" style="background:#ff4d6d;color:#fff;">STOP CAMERA</button>
    </div>

    <div class="card">
      <video id="video" autoplay playsinline muted></video>
      <div class="muted" id="info">Info: -</div>
    </div>

    <div class="card">
      <div style="font-weight:800;margin-bottom:6px;">Status / Error</div>
      <code id="log">-</code>
    </div>

    <div class="card">
      <div class="muted">
        Checklist cepat:
        <ul>
          <li>Buka lewat <b>Chrome</b> (bukan in-app browser)</li>
          <li>Alamat harus <b>https</b></li>
          <li>Site settings → Camera: <b>Allow</b></li>
          <li>Tutup aplikasi lain yang pakai kamera (WhatsApp/IG/Camera app)</li>
        </ul>
      </div>
    </div>
  </div>

<script>
  const video = document.getElementById('video');
  const logEl = document.getElementById('log');
  const infoEl = document.getElementById('info');
  let stream = null;

  function log(msg){
    const t = new Date().toLocaleTimeString();
    logEl.textContent = `[${t}] ${msg}\n` + logEl.textContent;
  }

  async function start(constraints){
    try{
      log('Requesting getUserMedia with constraints: ' + JSON.stringify(constraints));
      stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;

      const track = stream.getVideoTracks()[0];
      const settings = track.getSettings ? track.getSettings() : {};
      infoEl.textContent = `Info: OK ✅ | label=${track.label || '-'} | ${settings.width || '?'}x${settings.height || '?'} | fps=${settings.frameRate || '?'}`;

      log('SUCCESS: camera opened');
    }catch(e){
      infoEl.textContent = 'Info: FAILED ❌';
      log(`ERROR: ${e.name} — ${e.message || e}`);

      // kasih hint cepat berdasarkan error umum
      if (e.name === 'NotAllowedError') log('HINT: izin kamera ditolak / diblok. Cek Site settings & permission pop-up.');
      if (e.name === 'NotFoundError') log('HINT: device tidak menemukan kamera.');
      if (e.name === 'NotReadableError') log('HINT: kamera sedang dipakai app lain / gagal start. Tutup semua app kamera lalu coba lagi.');
      if (e.name === 'OverconstrainedError') log('HINT: constraint terlalu ketat. Coba START CAMERA (Simple).');
      if (e.name === 'SecurityError') log('HINT: harus HTTPS / secure context.');
    }
  }

  function stop(){
    if(stream){
      stream.getTracks().forEach(t => t.stop());
      stream = null;
      video.srcObject = null;
      infoEl.textContent = 'Info: stopped';
      log('STOP: camera stopped');
    }
  }

  document.getElementById('btnSimple').addEventListener('click', ()=> start({ video:true, audio:false }));
  document.getElementById('btnBack').addEventListener('click', ()=> start({ video:{ facingMode:{ ideal:'environment' } }, audio:false }));
  document.getElementById('btnStop').addEventListener('click', stop);

  // basic environment info
  log('UserAgent: ' + navigator.userAgent);
  log('SecureContext: ' + (window.isSecureContext ? 'YES' : 'NO'));
  if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia){
    log('FATAL: mediaDevices.getUserMedia not available in this browser.');
  }
</script>
</body>
</html>
